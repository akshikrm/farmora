<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: authController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: authController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import users from "#models/user"
import subscriptions from "#models/subscriptions"
import { Op } from 'sequelize';
import { generateToken } from '#utils/jwt';
import userService from "#services/authService";



/**
 * @module routes/userController
 * @description Routes for user-related operations.
 */
const userController = {}



/**
 * Registers a user
 * @async
 * @function signup
 * @memberof module:routes/userController
 * @param {Express.Request} req - Express request object
 * @param {Express.Response} res - Express response object
 * @returns {Promise&lt;void>} Sends a JSON response with the signup result.
 */
userController.signup = async (req, res) => {
	try {
		const user = await userService.create(req.body)
		if (user.status) {
			const token = generateToken(user.data);
			res.status(201).json({
				status: true,
				message: 'User created',
				token
			});
		} else {
			res.status(500).json({
				status: false,
				message: "user created"
			});
		}
	} catch (error) {
		res.status(400).json({ error: error.message });
	}
}

userController.login = async (req, res) => {
	const { username, password } = req.body;
	try {
		const user = await users.findOne({ where: { username } });
		if (!user)
			return res.status(404).json({
				status: false,
				error: 'User not found'
			});

		const isPasswordValid = await user.comparePassword(password);
		if (!isPasswordValid)
			return res.status(401).json({
				status: false,
				error: 'Invalid credentials'
			});

		const token = generateToken(user);
		const date = new Date().toISOString();

		user.last_login = date;
		user.save();
		if (user.user_type == 1) {
			res.json({
				status: true,
				token,
				master_id: user.id,
				name: user.name,
				username: user.username,
				user_type: user.usertype,
				parant_id: user.parant_id
			});
		} else {
			const checkSub = await subscriptions.findOne({ where: { status: 'active' } })
			if (checkSub) {
				res.json({
					status: true,
					token,
					master_id: user.id,
					name: user.name,
					username: user.username,
					user_type: user.usertype,
					parant_id: user.parant_id
				});
			} else {
				res.json({
					status: false,
					error: 'Sorry, your subscription is inactive. Please renew to continue.'
				});
			}
		}
	} catch (error) {
		res.status(500).json({
			status: false,
			error: error.message
		});
	}
}

userController.getAllUsers = async (req, res) => {
	try {
		const page = parseInt(req.query.page) || 1;
		const limit = parseInt(req.query.limit) || 10;
		const whereClause = { status: { [Op.ne]: 0 } }


		if (req.query.status) {
			whereClause.status = req.query.status
		}

		if (req.query.parant_id) {
			whereClause.parant_id = req.query.parant_id
		}



		const result = await userService.getAll(
			page, limit, whereClause
		);


		if (!result.success) {
			return res.status(500).json({
				message: result.message,
				error: result.error
			});
		}

		return res.status(200).json(result);
	} catch (error) {
		return res.status(500).json({
			status: false,
			error: error.message
		});
	}
}

export default userController
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-routes_userController.html">routes/userController</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Sun Oct 26 2025 12:18:43 GMT+0530 (India Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
